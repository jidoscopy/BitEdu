{"version":3,"sources":["../src/auth.ts","../src/utils.ts","../src/bitcoin/psbt.ts","../src/types/transactions.ts","../src/transactions/index.ts","../src/signature/index.ts","../src/signature/structuredData.ts","../src/profile/index.ts","../src/types/bitcoin.ts","../src/ui.ts","../src/asigna.ts","../src/providers.ts"],"names":["getStacksProvider","getProviderFromId","getSelectedProviderId","isStacksWalletInstalled","legacyNetworkFromConnectNetwork","network","LegacyStacksNetwork","LegacyStacksMainnet","TransactionVersion","LegacyStacksTestnet","defaultAuthURL","isMobile","ua","shouldUsePopup","getOrCreateUserSession","userSession","appConfig","AppConfig","UserSession","authenticate","authOptions","provider","redirectTo","manifestPath","onFinish","onCancel","sendToSignIn","_userSession","appDetails","transitKey","authRequest","authResponse","token","decodeToken","authResponsePayload","error","getUserData","TransactionTypes","ContractCallArgumentType","getUserSession","hasAppPrivateKey","e","getKeys","privateKey","publicKey","SECP256K1Client","getStxAddress","options","_a","stxAddress","_network","stxAddresses","chainIdToKey","ChainId","getDefaults","defaults","__spreadProps","__spreadValues","signPayload","payload","postConditions","postConditionToHex","pc","bytesToHex","legacySerializePostCondition","TokenSigner","createUnsignedTransactionPayload","createUnsecuredToken","openTransactionPopup","_b","_c","txResponse","txRaw","txBytes","hexToBytes","stacksTransaction","deserializeTransaction","makeContractCallToken","functionArgs","_options","__objRest","args","arg","serializeCV","legacySerializeCV","makeContractDeployToken","makeSTXTransferToken","amount","makeSignTransaction","txHex","generateTokenAndOpenPopup","makeTokenFn","openContractCall","openContractDeploy","openSTXTransfer","openSignTransaction","getDefaultPsbtRequestOptions","openPsbtPopup","psbtResponse","makePsbtToken","allowedSighash","hex","signAtIndex","openPsbtRequestPopup","getDefaultSignatureRequestOptions","openSignaturePopup","signatureResponse","signMessage","openSignatureRequestPopup","openStructuredDataSignaturePopup","parseUnserializableBigIntValues","message","domain","signStructuredMessage","openStructuredDataSignatureRequestPopup","getDefaultProfileUpdateRequestOptions","openProfileUpdatePopup","profileUpdateResponse","makeProfileUpdateToken","profile","openProfileUpdateRequestPopup","SignatureHash","source","generateCall","key","res","listener","generateAsignaMessage","AsignaIframeProvider","initializeAsignaProvider","DEFAULT_PROVIDERS","wrapConnectCall","action","persistSelection","selectedId","selectedProvider","defineCustomElements","defaultProviders","installedProviders","getInstalledProviders","element","originalOverflow","closeModal","handleEsc","ev","showConnect","showSTXTransfer","showContractCall","showContractDeploy","showSignTransaction","showPsbt","showProfileUpdate","showSignMessage","showSignStructuredMessage","disconnect","clearSelectedProviderId","showBlockstackConnect"],"mappings":"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","file":"index.mjs","sourcesContent":["import { AppConfig, UserSession } from '@stacks/auth';\nimport { decodeToken } from 'jsontokens';\nimport type { AuthOptions, AuthResponsePayload, StacksProvider } from './types';\n\nimport { getStacksProvider } from './utils';\n\nexport const defaultAuthURL = 'https://app.blockstack.org';\n\nif (typeof window !== 'undefined') {\n  window.__CONNECT_VERSION__ = '__VERSION__'; // replaced via tsup esbuildOptions\n}\n\nexport const isMobile = () => {\n  const ua = navigator.userAgent;\n  if (/android/i.test(ua)) {\n    return true;\n  }\n  if (/iPad|iPhone|iPod/.test(ua)) {\n    return true;\n  }\n  return /windows phone/i.test(ua);\n};\n\n/**\n * mobile should not use a 'popup' type of window.\n */\nexport const shouldUsePopup = () => {\n  return !isMobile();\n};\n\nexport const getOrCreateUserSession = (userSession?: UserSession): UserSession => {\n  if (!userSession) {\n    const appConfig = new AppConfig(['store_write'], document.location.href);\n    userSession = new UserSession({ appConfig });\n  }\n  return userSession;\n};\n\nexport const authenticate = async (\n  authOptions: AuthOptions,\n  provider: StacksProvider = getStacksProvider()\n) => {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n\n  const {\n    redirectTo = '/',\n    manifestPath,\n    onFinish,\n    onCancel,\n    sendToSignIn = false,\n    userSession: _userSession,\n    appDetails,\n  } = authOptions;\n  const userSession = getOrCreateUserSession(_userSession);\n  if (userSession.isUserSignedIn()) {\n    userSession.signUserOut();\n  }\n  const transitKey = userSession.generateAndStoreTransitKey();\n  const authRequest = userSession.makeAuthRequest(\n    transitKey,\n    `${document.location.origin}${redirectTo}`,\n    `${document.location.origin}${manifestPath}`,\n    userSession.appConfig.scopes,\n    undefined,\n    undefined,\n    {\n      sendToSignIn,\n      appDetails,\n      connectVersion: '__VERSION__', // replaced via tsup esbuildOptions,\n    }\n  );\n\n  try {\n    const authResponse = await provider.authenticationRequest(authRequest);\n    await userSession.handlePendingSignIn(authResponse);\n    const token = decodeToken(authResponse);\n    const payload = token?.payload;\n    const authResponsePayload = payload as unknown as AuthResponsePayload;\n    onFinish?.({\n      authResponse,\n      authResponsePayload,\n      userSession,\n    });\n  } catch (error) {\n    console.error('[Connect] Error during auth request', error);\n    onCancel?.();\n  }\n};\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport const getUserData = async (userSession?: UserSession) => {\n  userSession = getOrCreateUserSession(userSession);\n  if (userSession.isUserSignedIn()) {\n    return userSession.loadUserData();\n  }\n  if (userSession.isSignInPending()) {\n    return userSession.handlePendingSignIn();\n  }\n  return null;\n};\n","import { getSelectedProviderId, getProviderFromId } from '@stacks/connect-ui';\nimport {\n  StacksNetwork as LegacyStacksNetwork,\n  StacksMainnet as LegacyStacksMainnet,\n  StacksTestnet as LegacyStacksTestnet,\n} from '@stacks/network-v6';\nimport { ConnectNetwork } from './types';\nimport { TransactionVersion } from '@stacks/network';\n\nexport function getStacksProvider() {\n  const provider = getProviderFromId(getSelectedProviderId());\n  return provider || window.StacksProvider || window.BlockstackProvider;\n}\n\nexport function isStacksWalletInstalled() {\n  return !!getStacksProvider();\n}\n\n/** @internal */\nexport function legacyNetworkFromConnectNetwork(network?: ConnectNetwork): LegacyStacksNetwork {\n  if (!network) return new LegacyStacksTestnet();\n  if (typeof network === 'string') return LegacyStacksNetwork.fromName(network);\n  if ('version' in network) return network; // legacy type\n\n  if ('url' in network) return new LegacyStacksMainnet({ url: network.url }); // experimental\n\n  return network.transactionVersion === (TransactionVersion.Mainnet as number)\n    ? new LegacyStacksMainnet({ url: network.client.baseUrl })\n    : new LegacyStacksTestnet({ url: network.client.baseUrl });\n}\n","import { createUnsecuredToken, Json, TokenSigner } from 'jsontokens';\nimport { getKeys, getUserSession, hasAppPrivateKey } from '../transactions';\nimport { StacksProvider } from '../types';\nimport { PsbtPayload, PsbtPopup, PsbtRequestOptions } from '../types/bitcoin';\nimport { getStacksProvider, legacyNetworkFromConnectNetwork } from '../utils';\n\n// eslint-disable-next-line @typescript-eslint/require-await\nasync function signPayload(payload: PsbtPayload, privateKey: string) {\n  const tokenSigner = new TokenSigner('ES256k', privateKey);\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  return tokenSigner.signAsync({ ...payload } as any);\n}\n\nexport function getDefaultPsbtRequestOptions(options: PsbtRequestOptions) {\n  const network = legacyNetworkFromConnectNetwork(options.network);\n  const userSession = getUserSession(options.userSession);\n  const defaults: PsbtRequestOptions = {\n    ...options,\n    network,\n    userSession,\n  };\n  return {\n    ...defaults,\n  };\n}\n\nasync function openPsbtPopup({ token, options }: PsbtPopup, provider: StacksProvider) {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n\n  try {\n    const psbtResponse = await provider.psbtRequest(token);\n    options.onFinish?.(psbtResponse);\n  } catch (error) {\n    console.error('[Connect] Error during psbt request', error);\n    options.onCancel?.();\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport const makePsbtToken = async (options: PsbtRequestOptions) => {\n  const { allowedSighash, hex, signAtIndex, userSession, ..._options } = options;\n  if (hasAppPrivateKey(userSession)) {\n    const { privateKey, publicKey } = getKeys(userSession);\n\n    const payload: PsbtPayload = {\n      ..._options,\n      allowedSighash,\n      hex,\n      signAtIndex,\n      publicKey,\n    };\n\n    return signPayload(payload, privateKey);\n  }\n  const payload = { ..._options };\n  return createUnsecuredToken(payload as Json);\n};\n\nasync function generateTokenAndOpenPopup<T extends PsbtRequestOptions>(\n  options: T,\n  makeTokenFn: (options: T) => Promise<string>,\n  provider: StacksProvider\n) {\n  const token = await makeTokenFn({\n    ...getDefaultPsbtRequestOptions(options),\n    ...options,\n  } as T);\n  return openPsbtPopup({ token, options }, provider);\n}\n\n/**\n * @experimental\n */\nexport function openPsbtRequestPopup(\n  options: PsbtRequestOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  return generateTokenAndOpenPopup(options, makePsbtToken, provider);\n}\n","import { UserSession } from '@stacks/auth';\nimport type { AuthOptions } from '../types/auth';\nimport {\n  ClarityValue as LegacyClarityValue,\n  PostCondition as LegacyPostCondition,\n} from '@stacks/transactions-v6';\nimport {\n  PostConditionMode,\n  PostCondition,\n  AnchorMode,\n  ClarityValue,\n  StacksTransactionWire,\n} from '@stacks/transactions';\nimport { ConnectNetwork } from './network';\n\nexport interface TxBase {\n  appDetails?: AuthOptions['appDetails'];\n  postConditionMode?: PostConditionMode;\n  postConditions?: (string | LegacyPostCondition | PostCondition)[];\n  network?: ConnectNetwork;\n  anchorMode?: AnchorMode;\n  attachment?: string;\n  fee?: number | string;\n  /**\n   * Provide the Hiro Wallet with a suggested account to sign this transaction with.\n   * This is set by default if a `userSession` option is provided.\n   */\n  stxAddress?: string;\n  /** @deprecated `unused - only included for compatibility with @stacks/transactions` */\n  senderKey?: string;\n  /** @deprecated `unused - only included for compatibility with @stacks/transactions` */\n  nonce?: number;\n}\n\nexport interface SignTransactionBase {\n  appDetails?: AuthOptions['appDetails'];\n  network?: ConnectNetwork;\n  attachment?: string;\n  /**\n   * Provide wallets with a suggested account to sign this transaction with.\n   * This is set by default if a `userSession` option is provided.\n   */\n  stxAddress?: string;\n  txHex: string;\n  /** @deprecated `unused - only included for compatibility with other transaction types` */\n  postConditions?: (string | LegacyPostCondition | PostCondition)[];\n}\n\nexport interface SponsoredFinishedTxPayload {\n  txRaw: string;\n}\n\nexport interface SponsoredFinishedTxData extends SponsoredFinishedTxPayload {\n  stacksTransaction: StacksTransactionWire;\n}\n\nexport interface FinishedTxPayload extends SponsoredFinishedTxPayload {\n  txId: string;\n}\n\nexport interface FinishedTxData extends FinishedTxPayload {\n  stacksTransaction: StacksTransactionWire;\n}\n\nexport enum TransactionTypes {\n  ContractCall = 'contract_call',\n  ContractDeploy = 'smart_contract',\n  STXTransfer = 'token_transfer',\n}\n\n/**\n * Contract Call\n */\n\nexport enum ContractCallArgumentType {\n  BUFFER = 'buffer',\n  UINT = 'uint',\n  INT = 'int',\n  PRINCIPAL = 'principal',\n  BOOL = 'bool',\n}\n\nexport interface ContractCallBase extends TxBase {\n  contractAddress: string;\n  contractName: string;\n  functionName: string;\n  functionArgs: (string | LegacyClarityValue | ClarityValue)[];\n}\n\nexport interface OptionsBase {\n  /**\n   * @deprecated Authentication is no longer supported through a hosted\n   * version. Users must install an extension.\n   */\n  authOrigin?: string;\n  userSession?: UserSession;\n}\n\nexport type SponsoredFinished = (data: SponsoredFinishedTxData) => void;\nexport type Finished = (data: FinishedTxData) => void;\nexport type Canceled = () => void;\n\nexport interface SponsoredOptionsBase extends TxBase, OptionsBase {\n  sponsored: true;\n  onFinish?: SponsoredFinished;\n  onCancel?: Canceled;\n}\n\nexport interface RegularOptionsBase extends TxBase, OptionsBase {\n  sponsored?: false;\n  onFinish?: Finished;\n  onCancel?: Canceled;\n}\n\nexport type ContractCallRegularOptions = ContractCallBase & RegularOptionsBase;\nexport type ContractCallSponsoredOptions = ContractCallBase & SponsoredOptionsBase;\nexport type ContractCallOptions = ContractCallRegularOptions | ContractCallSponsoredOptions;\n\nexport interface ContractCallArgument {\n  type: ContractCallArgumentType;\n  value: string;\n}\n\nexport interface ContractCallPayload extends ContractCallBase {\n  txType: TransactionTypes.ContractCall;\n  publicKey: string;\n  functionArgs: string[];\n  sponsored?: boolean;\n}\n\n/**\n * Contract Deploy\n */\nexport interface ContractDeployBase extends TxBase {\n  contractName: string;\n  codeBody: string;\n  /**\n   * Optional integer value to specify the Clarity version to use for this contract.\n   * Current live Clarity versions are: `1`, `2`, and `3`.\n   *\n   * ⚠︎ Warning: Wallets may not support this parameter yet and typically default to the latest Clarity version.\n   */\n  clarityVersion?: number;\n}\n\nexport type ContractDeployRegularOptions = ContractDeployBase & RegularOptionsBase;\nexport type ContractDeploySponsoredOptions = ContractDeployBase & SponsoredOptionsBase;\nexport type ContractDeployOptions = ContractDeployRegularOptions | ContractDeploySponsoredOptions;\n\nexport interface ContractDeployPayload extends ContractDeployBase {\n  publicKey: string;\n  txType: TransactionTypes.ContractDeploy;\n  sponsored?: boolean;\n}\n\n/**\n * STX Transfer\n */\n\nexport interface STXTransferBase extends TxBase {\n  recipient: string;\n  amount: BigInt | string;\n  memo?: string;\n}\n\nexport type STXTransferRegularOptions = STXTransferBase & RegularOptionsBase;\nexport type STXTransferSponsoredOptions = STXTransferBase & SponsoredOptionsBase;\nexport type STXTransferOptions = STXTransferRegularOptions | STXTransferSponsoredOptions;\n\nexport interface STXTransferPayload extends STXTransferBase {\n  publicKey: string;\n  txType: TransactionTypes.STXTransfer;\n  amount: string;\n  sponsored?: boolean;\n}\n\n/**\n * Transaction Popup\n */\n\nexport type TransactionOptions =\n  | ContractCallOptions\n  | ContractDeployOptions\n  | STXTransferOptions\n  | SignTransactionOptions;\nexport type TransactionPayload =\n  | ContractCallPayload\n  | ContractDeployPayload\n  | STXTransferPayload\n  | SignTransactionPayload;\n\nexport interface TransactionPopup {\n  token: string;\n  options: TransactionOptions;\n}\n\nexport interface SignTransactionOptionBase extends SignTransactionBase, OptionsBase {\n  onFinish?: SignTransactionFinished;\n  onCancel?: Canceled;\n}\n\nexport interface SignTransactionPayload extends SignTransactionBase {\n  publicKey: string;\n}\n\nexport type SignTransactionFinished = (data: SignTransactionFinishedTxData) => void;\n\nexport type SignTransactionOptions = SignTransactionOptionBase;\n\nexport interface SignTransactionFinishedTxData {\n  stacksTransaction: StacksTransactionWire;\n}\n","import { AppConfig, UserSession } from '@stacks/auth';\nimport { bytesToHex, hexToBytes } from '@stacks/common';\nimport { ChainId } from '@stacks/network';\nimport {\n  deserializeTransaction,\n  PostCondition,\n  postConditionToHex,\n  serializeCV,\n} from '@stacks/transactions';\nimport {\n  PostCondition as LegacyPostCondition,\n  serializeCV as legacySerializeCV,\n  serializePostCondition as legacySerializePostCondition,\n} from '@stacks/transactions-v6';\nimport { createUnsecuredToken, Json, SECP256K1Client, TokenSigner } from 'jsontokens';\nimport { StacksProvider } from '../types';\nimport {\n  ContractCallOptions,\n  ContractCallPayload,\n  ContractCallRegularOptions,\n  ContractCallSponsoredOptions,\n  ContractDeployOptions,\n  ContractDeployPayload,\n  ContractDeployRegularOptions,\n  ContractDeploySponsoredOptions,\n  FinishedTxPayload,\n  SignTransactionOptions,\n  SignTransactionPayload,\n  SponsoredFinishedTxPayload,\n  STXTransferOptions,\n  STXTransferPayload,\n  STXTransferRegularOptions,\n  STXTransferSponsoredOptions,\n  TransactionOptions,\n  TransactionPayload,\n  TransactionPopup,\n  TransactionTypes,\n} from '../types/transactions';\nimport { getStacksProvider, legacyNetworkFromConnectNetwork } from '../utils';\n\n// TODO extract out of transactions\nexport const getUserSession = (_userSession?: UserSession) => {\n  let userSession = _userSession;\n\n  if (!userSession) {\n    const appConfig = new AppConfig(['store_write'], document.location.href);\n    userSession = new UserSession({ appConfig });\n  }\n  return userSession;\n};\n\nexport function hasAppPrivateKey(userSession?: UserSession) {\n  try {\n    const session = getUserSession(userSession).loadUserData();\n    return session.appPrivateKey;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport const getKeys = (_userSession?: UserSession) => {\n  const userSession = getUserSession(_userSession);\n  const privateKey = userSession.loadUserData().appPrivateKey;\n  const publicKey = SECP256K1Client.derivePublicKey(privateKey);\n\n  return { privateKey, publicKey };\n};\n\n// TODO extract out of transactions\nexport function getStxAddress(options: TransactionOptions) {\n  const { stxAddress, userSession, network: _network } = options;\n\n  if (stxAddress) return stxAddress;\n  if (!userSession || !_network) return undefined;\n  const stxAddresses = userSession?.loadUserData().profile?.stxAddress;\n\n  const chainIdToKey = {\n    [ChainId.Mainnet]: 'mainnet',\n    [ChainId.Testnet]: 'testnet',\n  };\n  const network = legacyNetworkFromConnectNetwork(_network);\n  const address: string | undefined = stxAddresses?.[chainIdToKey[network.chainId]];\n  return address;\n}\n\nfunction getDefaults(options: TransactionOptions) {\n  const network = legacyNetworkFromConnectNetwork(options.network);\n\n  const userSession = getUserSession(options.userSession);\n  const defaults: TransactionOptions = {\n    ...options,\n    network,\n    userSession,\n  };\n\n  return {\n    stxAddress: getStxAddress(defaults),\n    ...defaults,\n  };\n}\n\n// eslint-disable-next-line @typescript-eslint/require-await\nasync function signPayload(payload: TransactionPayload, privateKey: string) {\n  let { postConditions } = payload;\n  if (postConditions && postConditions.length > 0 && typeof postConditions[0] !== 'string') {\n    if (typeof postConditions[0].type === 'string') {\n      // new readable types\n      postConditions = (postConditions as PostCondition[]).map(postConditionToHex);\n    } else {\n      // legacy types\n      postConditions = (postConditions as LegacyPostCondition[]).map(pc => {\n        return bytesToHex(legacySerializePostCondition(pc));\n      });\n    }\n  }\n  const tokenSigner = new TokenSigner('ES256k', privateKey);\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  return tokenSigner.signAsync({ ...payload, postConditions } as any);\n}\n\nfunction createUnsignedTransactionPayload(payload: Partial<TransactionPayload>) {\n  let { postConditions } = payload;\n  if (postConditions && postConditions.length > 0 && typeof postConditions[0] !== 'string') {\n    if (typeof postConditions[0].type === 'string') {\n      // new readable types\n      postConditions = (postConditions as PostCondition[]).map(postConditionToHex);\n    } else {\n      // legacy types\n      postConditions = (postConditions as LegacyPostCondition[]).map(pc => {\n        return bytesToHex(legacySerializePostCondition(pc));\n      });\n    }\n  }\n  return createUnsecuredToken({ ...payload, postConditions } as unknown as Json);\n}\n\nconst openTransactionPopup = async (\n  { token, options }: TransactionPopup,\n  provider: StacksProvider\n) => {\n  try {\n    const txResponse = await provider.transactionRequest(token);\n    const { txRaw } = txResponse;\n    const txBytes = hexToBytes(txRaw.replace(/^0x/, ''));\n    const stacksTransaction = deserializeTransaction(txBytes);\n\n    if ('sponsored' in options && options.sponsored) {\n      options.onFinish?.({\n        ...(txResponse as SponsoredFinishedTxPayload),\n        stacksTransaction,\n      });\n      return;\n    }\n    options.onFinish?.({\n      ...(txResponse as FinishedTxPayload),\n      stacksTransaction,\n    });\n  } catch (error) {\n    console.error('[Connect] Error during transaction request', error);\n    options.onCancel?.();\n  }\n};\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport const makeContractCallToken = async (options: ContractCallOptions) => {\n  const { functionArgs, appDetails, userSession, ..._options } = options;\n\n  const args: string[] = functionArgs.map(arg => {\n    if (typeof arg === 'string') {\n      return arg;\n    }\n    if (typeof arg.type === 'string') {\n      // new readable types\n      return serializeCV(arg);\n    }\n\n    // legacy types\n    return bytesToHex(legacySerializeCV(arg));\n  });\n  if (hasAppPrivateKey(userSession)) {\n    const { privateKey, publicKey } = getKeys(userSession);\n    const payload: ContractCallPayload = {\n      ..._options,\n      functionArgs: args,\n      txType: TransactionTypes.ContractCall,\n      publicKey,\n    };\n    if (appDetails) payload.appDetails = appDetails;\n    return signPayload(payload, privateKey);\n  }\n  const payload: Partial<ContractCallPayload> = {\n    ..._options,\n    functionArgs: args,\n    txType: TransactionTypes.ContractCall,\n  };\n  if (appDetails) payload.appDetails = appDetails;\n  return createUnsignedTransactionPayload(payload);\n};\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport const makeContractDeployToken = async (options: ContractDeployOptions) => {\n  const { appDetails, userSession, ..._options } = options;\n  if (hasAppPrivateKey(userSession)) {\n    const { privateKey, publicKey } = getKeys(userSession);\n    const payload: ContractDeployPayload = {\n      ..._options,\n      publicKey,\n      txType: TransactionTypes.ContractDeploy,\n    };\n    if (appDetails) payload.appDetails = appDetails;\n    return signPayload(payload, privateKey);\n  }\n\n  const payload: Partial<ContractDeployPayload> = {\n    ..._options,\n    txType: TransactionTypes.ContractDeploy,\n  };\n  if (appDetails) payload.appDetails = appDetails;\n  return createUnsignedTransactionPayload(payload);\n};\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport const makeSTXTransferToken = async (options: STXTransferOptions) => {\n  const { amount, appDetails, userSession, ..._options } = options;\n\n  if (hasAppPrivateKey(userSession)) {\n    const { privateKey, publicKey } = getKeys(userSession);\n    const payload: STXTransferPayload = {\n      ..._options,\n      amount: amount.toString(10),\n      publicKey,\n      txType: TransactionTypes.STXTransfer,\n    };\n    if (appDetails) payload.appDetails = appDetails;\n    return signPayload(payload, privateKey);\n  }\n\n  const payload: Partial<STXTransferPayload> = {\n    ..._options,\n    amount: amount.toString(10),\n    txType: TransactionTypes.STXTransfer,\n  };\n  if (appDetails) payload.appDetails = appDetails;\n  return createUnsignedTransactionPayload(payload);\n};\n\nexport const makeSignTransaction = async (options: SignTransactionOptions) => {\n  const { txHex, appDetails, userSession, ..._options } = options;\n\n  if (hasAppPrivateKey(userSession)) {\n    const { privateKey, publicKey } = getKeys(userSession);\n    const payload: SignTransactionPayload = {\n      ..._options,\n      txHex,\n      publicKey,\n    };\n    if (appDetails) payload.appDetails = appDetails;\n    return signPayload(payload, privateKey);\n  }\n\n  const payload: Partial<SignTransactionOptions> = {\n    ..._options,\n    txHex,\n  };\n  if (appDetails) payload.appDetails = appDetails;\n  return createUnsignedTransactionPayload(payload);\n};\n\nasync function generateTokenAndOpenPopup<T extends TransactionOptions>(\n  options: T,\n  makeTokenFn: (options: T) => Promise<string>,\n  provider: StacksProvider\n) {\n  const token = await makeTokenFn({\n    ...getDefaults(options),\n    ...options,\n    network: legacyNetworkFromConnectNetwork(options.network), // ensure network is legacy compatible\n  } as T);\n  return openTransactionPopup({ token, options }, provider);\n}\n\nexport function openContractCall(\n  options: ContractCallOptions | ContractCallRegularOptions | ContractCallSponsoredOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n  return generateTokenAndOpenPopup(options, makeContractCallToken, provider);\n}\n\nexport function openContractDeploy(\n  options: ContractDeployOptions | ContractDeployRegularOptions | ContractDeploySponsoredOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n  return generateTokenAndOpenPopup(options, makeContractDeployToken, provider);\n}\n\nexport function openSTXTransfer(\n  options: STXTransferOptions | STXTransferRegularOptions | STXTransferSponsoredOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n  return generateTokenAndOpenPopup(options, makeSTXTransferToken, provider);\n}\n\nexport function openSignTransaction(\n  options: SignTransactionOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n  return generateTokenAndOpenPopup(options, makeSignTransaction, provider);\n}\n","import { ChainId } from '@stacks/network';\nimport { createUnsecuredToken, TokenSigner } from 'jsontokens';\nimport { getKeys, getUserSession, hasAppPrivateKey } from '../transactions';\nimport { StacksProvider } from '../types';\nimport {\n  CommonSignatureRequestOptions,\n  SignatureOptions,\n  SignaturePayload,\n  SignaturePopup,\n  SignatureRequestOptions,\n} from '../types/signature';\nimport { getStacksProvider, legacyNetworkFromConnectNetwork } from '../utils';\n\nfunction getStxAddress(options: CommonSignatureRequestOptions) {\n  const { userSession, network: _network } = options;\n\n  if (!userSession || !_network) return undefined;\n  const stxAddresses = userSession?.loadUserData().profile?.stxAddress;\n  const chainIdToKey = {\n    [ChainId.Mainnet]: 'mainnet',\n    [ChainId.Testnet]: 'testnet',\n  };\n  const network = legacyNetworkFromConnectNetwork(_network);\n  const address: string | undefined = stxAddresses?.[chainIdToKey[network.chainId]];\n  return address;\n}\n\n// eslint-disable-next-line @typescript-eslint/require-await\nasync function signPayload(payload: SignaturePayload, privateKey: string) {\n  const tokenSigner = new TokenSigner('ES256k', privateKey);\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  return tokenSigner.signAsync({ ...payload } as any);\n}\n\nexport function getDefaultSignatureRequestOptions(options: CommonSignatureRequestOptions) {\n  const network = legacyNetworkFromConnectNetwork(options.network);\n  const userSession = getUserSession(options.userSession);\n  const defaults: CommonSignatureRequestOptions = {\n    ...options,\n    network,\n    userSession,\n  };\n  return {\n    stxAddress: getStxAddress(defaults),\n    ...defaults,\n  };\n}\n\nasync function openSignaturePopup({ token, options }: SignaturePopup, provider: StacksProvider) {\n  try {\n    const signatureResponse = await provider.signatureRequest(token);\n    options.onFinish?.(signatureResponse);\n  } catch (error) {\n    console.error('[Connect] Error during signature request', error);\n    options.onCancel?.();\n  }\n}\n\nexport interface SignatureRequestPayload {\n  message: string;\n}\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport const signMessage = async (options: SignatureRequestOptions) => {\n  const { userSession, ..._options } = options;\n  if (hasAppPrivateKey(userSession)) {\n    const { privateKey, publicKey } = getKeys(userSession);\n\n    const payload: SignaturePayload = {\n      ..._options,\n      publicKey,\n    };\n\n    return signPayload(payload, privateKey);\n  }\n  const payload = { ..._options };\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  return createUnsecuredToken(payload as any);\n};\n\nasync function generateTokenAndOpenPopup<T extends SignatureOptions>(\n  options: T,\n  makeTokenFn: (options: T) => Promise<string>,\n  provider: StacksProvider\n) {\n  const token = await makeTokenFn({\n    ...getDefaultSignatureRequestOptions(options),\n    ...options,\n  } as T);\n  return openSignaturePopup({ token, options }, provider);\n}\n\nexport function openSignatureRequestPopup(\n  options: SignatureRequestOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n  return generateTokenAndOpenPopup(options, signMessage, provider);\n}\n","import { bytesToHex } from '@stacks/common';\nimport {\n  serializeCV as legacySerializeCV,\n  ClarityValue as LegacyClarityValue,\n  TupleCV as LegacyTupleCV,\n} from '@stacks/transactions-v6';\nimport { serializeCV } from '@stacks/transactions';\nimport { createUnsecuredToken, Json, TokenSigner } from 'jsontokens';\nimport { getDefaultSignatureRequestOptions } from '.';\nimport { getKeys, hasAppPrivateKey } from '../transactions';\nimport {\n  StructuredDataSignatureOptions,\n  StructuredDataSignaturePayload,\n  StructuredDataSignaturePopup,\n  StructuredDataSignatureRequestOptions,\n} from '../types/structuredDataSignature';\nimport { getStacksProvider } from '../utils';\nimport { StacksProvider } from '../types';\n\nasync function generateTokenAndOpenPopup<T extends StructuredDataSignatureOptions>(\n  options: T,\n  makeTokenFn: (options: T) => Promise<string>,\n  provider: StacksProvider\n) {\n  const token = await makeTokenFn({\n    ...getDefaultSignatureRequestOptions(options),\n    ...options,\n  } as T);\n  return openStructuredDataSignaturePopup({ token, options }, provider);\n}\n\nfunction parseUnserializableBigIntValues(payload: StructuredDataSignaturePayload) {\n  const { message, domain } = payload;\n\n  if (typeof message.type === 'string' && typeof domain.type === 'string') {\n    // new readable types\n    return {\n      ...payload,\n      message: serializeCV(message),\n      domain: serializeCV(domain),\n    } as Json;\n  }\n\n  // legacy types\n  return {\n    ...payload,\n    message: bytesToHex(legacySerializeCV(message as LegacyClarityValue)),\n    domain: bytesToHex(legacySerializeCV(domain as LegacyTupleCV)),\n  } as Json;\n}\n\n// eslint-disable-next-line @typescript-eslint/require-await\nasync function signPayload(payload: StructuredDataSignaturePayload, privateKey: string) {\n  const tokenSigner = new TokenSigner('ES256k', privateKey);\n  return tokenSigner.signAsync(parseUnserializableBigIntValues(payload));\n}\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport async function signStructuredMessage(options: StructuredDataSignatureRequestOptions) {\n  const { userSession, ..._options } = options;\n  if (hasAppPrivateKey(userSession)) {\n    const { privateKey, publicKey } = getKeys(userSession);\n    const payload: StructuredDataSignaturePayload = {\n      ..._options,\n      publicKey,\n    };\n    return signPayload(payload, privateKey);\n  }\n  return createUnsecuredToken(\n    parseUnserializableBigIntValues(options as StructuredDataSignaturePayload)\n  );\n}\n\nasync function openStructuredDataSignaturePopup(\n  { token, options }: StructuredDataSignaturePopup,\n  provider: StacksProvider\n) {\n  try {\n    const signatureResponse = await provider.structuredDataSignatureRequest(token);\n\n    options.onFinish?.(signatureResponse);\n  } catch (error) {\n    console.error('[Connect] Error during signature request', error);\n    options.onCancel?.();\n  }\n}\n\nexport function openStructuredDataSignatureRequestPopup(\n  options: StructuredDataSignatureRequestOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n  return generateTokenAndOpenPopup(options, signStructuredMessage, provider);\n}\n","import { createUnsecuredToken, Json, TokenSigner } from 'jsontokens';\nimport { getKeys, getUserSession, hasAppPrivateKey } from '../transactions';\nimport {\n  ProfileUpdatePayload,\n  ProfileUpdatePopup,\n  ProfileUpdateRequestOptions,\n  StacksProvider,\n} from '../types';\n\nimport { getStacksProvider, legacyNetworkFromConnectNetwork } from '../utils';\n\n// eslint-disable-next-line @typescript-eslint/require-await\nasync function signPayload(payload: ProfileUpdatePayload, privateKey: string) {\n  const tokenSigner = new TokenSigner('ES256k', privateKey);\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  return tokenSigner.signAsync({ ...payload } as any);\n}\n\nexport function getDefaultProfileUpdateRequestOptions(options: ProfileUpdateRequestOptions) {\n  const network = legacyNetworkFromConnectNetwork(options.network);\n  const userSession = getUserSession(options.userSession);\n  const defaults: ProfileUpdateRequestOptions = {\n    ...options,\n    network,\n    userSession,\n  };\n  return {\n    ...defaults,\n  };\n}\n\nasync function openProfileUpdatePopup(\n  { token, options }: ProfileUpdatePopup,\n  provider: StacksProvider\n) {\n  try {\n    const profileUpdateResponse = await provider.profileUpdateRequest(token);\n    options.onFinish?.(profileUpdateResponse);\n  } catch (error) {\n    console.error('[Connect] Error during signature request', error);\n    options.onCancel?.();\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/require-await\nexport const makeProfileUpdateToken = async (options: ProfileUpdateRequestOptions) => {\n  const { userSession, profile, ..._options } = options;\n  if (hasAppPrivateKey(userSession)) {\n    const { privateKey, publicKey } = getKeys(userSession);\n\n    const payload: ProfileUpdatePayload = {\n      ..._options,\n      profile,\n      publicKey,\n    };\n\n    return signPayload(payload, privateKey);\n  }\n  const payload = { ..._options };\n  return createUnsecuredToken(payload as Json);\n};\n\nasync function generateTokenAndOpenPopup<T extends ProfileUpdateRequestOptions>(\n  options: T,\n  makeTokenFn: (options: T) => Promise<string>,\n  provider: StacksProvider\n) {\n  const token = await makeTokenFn({\n    ...getDefaultProfileUpdateRequestOptions(options),\n    ...options,\n  } as T);\n  return openProfileUpdatePopup({ token, options }, provider);\n}\n\nexport function openProfileUpdateRequestPopup(\n  options: ProfileUpdateRequestOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n  return generateTokenAndOpenPopup(options, makeProfileUpdateToken, provider);\n}\n","import { UserSession } from '@stacks/auth';\n\nimport { AuthOptions } from './auth';\nimport { ConnectNetwork } from './network';\n\n// Taken from @scure/btc-signer\n// https://github.com/paulmillr/scure-btc-signer\nexport enum SignatureHash {\n  DEFAULT = 0,\n  ALL = 1,\n  NONE = 2,\n  SINGLE = 3,\n  ANYONECANPAY = 0x80,\n}\n\nexport interface PsbtData {\n  hex: string;\n}\n\nexport type PsbtCanceled = () => void;\nexport type PsbtFinished = (data: PsbtData) => void;\n\nexport interface PsbtBase {\n  appDetails?: AuthOptions['appDetails'];\n  authOrigin?: string;\n  network?: ConnectNetwork;\n  onCancel?: PsbtCanceled;\n  onFinish?: PsbtFinished;\n  stxAddress?: string;\n  userSession?: UserSession;\n}\n\nexport interface PsbtRequestOptions extends PsbtBase {\n  allowedSighash?: SignatureHash[];\n  hex: string;\n  signAtIndex?: number | number[];\n}\n\nexport interface CommonPsbtPayload extends PsbtBase {\n  publicKey: string;\n}\n\nexport interface PsbtPayload extends CommonPsbtPayload {\n  allowedSighash?: SignatureHash[];\n  hex: string;\n  signAtIndex?: number | number[];\n}\n\n/**\n * Psbt Popup\n */\nexport interface PsbtPopup {\n  token: string;\n  options: PsbtRequestOptions;\n}\n","import {\n  WebBTCProvider,\n  clearSelectedProviderId,\n  getInstalledProviders,\n  getSelectedProviderId,\n} from '@stacks/connect-ui';\nimport { defineCustomElements } from '@stacks/connect-ui/loader';\nimport { authenticate } from './auth';\nimport { openPsbtRequestPopup } from './bitcoin';\nimport { openProfileUpdateRequestPopup } from './profile';\nimport { openSignatureRequestPopup } from './signature';\nimport { openStructuredDataSignatureRequestPopup } from './signature/structuredData';\nimport {\n  openContractCall,\n  openContractDeploy,\n  openSTXTransfer,\n  openSignTransaction,\n} from './transactions';\nimport {\n  ContractCallOptions,\n  ContractDeployOptions,\n  ProfileUpdateRequestOptions,\n  PsbtRequestOptions,\n  STXTransferOptions,\n  SignatureRequestOptions,\n  StacksProvider,\n  StructuredDataSignatureRequestOptions,\n  TransactionOptions,\n} from './types';\nimport type { AuthOptions } from './types/auth';\nimport { getStacksProvider } from './utils';\nimport { DEFAULT_PROVIDERS } from './providers';\n\nexport type ActionOptions = (\n  | AuthOptions\n  | STXTransferOptions\n  | ContractCallOptions\n  | ContractDeployOptions\n  | TransactionOptions\n  | PsbtRequestOptions\n  | ProfileUpdateRequestOptions\n  | SignatureRequestOptions\n  | StructuredDataSignatureRequestOptions\n) & {\n  defaultProviders?: WebBTCProvider[];\n};\n\n/** Helper higher-order function for creating connect methods that allow for wallet selection */\nfunction wrapConnectCall<O extends ActionOptions>(\n  action: (options: O, provider?: StacksProvider) => any,\n  persistSelection = true\n) {\n  return function wrapped(options: O, provider?: StacksProvider) {\n    if (provider) return action(options, provider); // if a provider is passed, use it\n\n    const selectedId = getSelectedProviderId();\n    const selectedProvider = getStacksProvider();\n    if (selectedId && selectedProvider) return action(options, selectedProvider); // if a provider is selected, use it\n\n    if (typeof window === 'undefined') return;\n    void defineCustomElements(window);\n\n    const defaultProviders = options?.defaultProviders ?? DEFAULT_PROVIDERS;\n    const installedProviders = getInstalledProviders(defaultProviders);\n\n    const element = document.createElement('connect-modal');\n    element.defaultProviders = defaultProviders;\n    element.installedProviders = installedProviders;\n    element.persistSelection = persistSelection;\n\n    const originalOverflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n\n    const closeModal = () => {\n      element.remove();\n      document.body.style.overflow = originalOverflow;\n    };\n\n    element.callback = (selectedProvider: StacksProvider | undefined) => {\n      closeModal();\n      action(options, selectedProvider);\n    };\n    element.cancelCallback = () => {\n      closeModal();\n      options.onCancel?.();\n    };\n\n    document.body.appendChild(element);\n\n    const handleEsc = (ev: KeyboardEvent) => {\n      if (ev.key === 'Escape') {\n        document.removeEventListener('keydown', handleEsc);\n        element.remove();\n      }\n    };\n    document.addEventListener('keydown', handleEsc);\n  };\n}\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link authenticate} action. */\nexport const showConnect = wrapConnectCall(authenticate, false);\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openSTXTransfer} action. */\nexport const showSTXTransfer = wrapConnectCall(openSTXTransfer);\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openContractCall} action. */\nexport const showContractCall = wrapConnectCall(openContractCall);\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openContractDeploy} action. */\nexport const showContractDeploy = wrapConnectCall(openContractDeploy);\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openSignTransaction} action. */\nexport const showSignTransaction = wrapConnectCall(openSignTransaction);\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openPsbtRequestPopup} action. */\nexport const showPsbt = wrapConnectCall(openPsbtRequestPopup);\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openProfileUpdateRequestPopup} action. */\nexport const showProfileUpdate = wrapConnectCall(openProfileUpdateRequestPopup);\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openSignatureRequestPopup} action. */\nexport const showSignMessage = wrapConnectCall(openSignatureRequestPopup);\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openStructuredDataSignatureRequestPopup} action. */\nexport const showSignStructuredMessage = wrapConnectCall(openStructuredDataSignatureRequestPopup);\n\n/** Disconnect selected wallet. Alias for {@link clearSelectedProviderId} */\nexport const disconnect = clearSelectedProviderId;\n\n/**\n * @deprecated Use the renamed {@link showConnect} method\n */\nexport const showBlockstackConnect = showConnect;\n","const source = 'asigna-stx';\n\nconst generateCall = (payload: string, key: string) => {\n  return new Promise(res => {\n    function listener(message: MessageEvent<any>) {\n      if (message.data.source === source && message.data[key]) {\n        res(message.data[key]);\n        window.removeEventListener('message', listener);\n      }\n    }\n    window.addEventListener('message', listener);\n    window.top.postMessage(generateAsignaMessage(payload, key), '*');\n  });\n};\n\nconst AsignaIframeProvider = {\n  authenticationRequest: async (payload: string) => {\n    return generateCall(payload, 'authenticationRequest');\n  },\n  transactionRequest: async (payload: string) => {\n    return generateCall(payload, 'transactionRequest');\n  },\n};\nconst generateAsignaMessage = (payload: string, key: string) => {\n  return { source, [key]: payload };\n};\n\nexport const initializeAsignaProvider = () => {\n  if (typeof window === 'undefined') return;\n\n  const isIframe = window.top !== window.self;\n  if (isIframe) {\n    window['AsignaProvider'] = AsignaIframeProvider;\n  }\n};\n","import { WebBTCProvider } from '@stacks/connect-ui';\nimport { initializeAsignaProvider } from './asigna';\n\ninitializeAsignaProvider();\n\nexport const DEFAULT_PROVIDERS: WebBTCProvider[] = [\n  {\n    id: 'LeatherProvider',\n    name: 'Leather',\n    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiByeD0iMjYuODM4NyIgZmlsbD0iIzEyMTAwRiIvPgo8cGF0aCBkPSJNNzQuOTE3MSA1Mi43MTE0QzgyLjQ3NjYgNTEuNTQwOCA5My40MDg3IDQzLjU4MDQgOTMuNDA4NyAzNy4zNzYxQzkzLjQwODcgMzUuNTAzMSA5MS44OTY4IDM0LjIxNTQgODkuNjg3MSAzNC4yMTU0Qzg1LjUwMDQgMzQuMjE1NCA3OC40MDYxIDQwLjUzNjggNzQuOTE3MSA1Mi43MTE0Wk0zOS45MTEgODMuNDk5MUMzMC4wMjU2IDgzLjQ5OTEgMjkuMjExNSA5My4zMzI0IDM5LjA5NjkgOTMuMzMyNEM0My41MTYzIDkzLjMzMjQgNDguODY2MSA5MS41NzY0IDUxLjY1NzMgODguNDE1N0M0Ny41ODY4IDg0LjkwMzggNDQuMjE0MSA4My40OTkxIDM5LjkxMSA4My40OTkxWk0xMDIuODI5IDc5LjI4NDhDMTAzLjQxIDk1Ljc5MDcgOTUuMDM2OSAxMDUuMDM5IDgwLjg0ODQgMTA1LjAzOUM3Mi40NzQ4IDEwNS4wMzkgNjguMjg4MSAxMDEuODc4IDU5LjMzMyA5Ni4wMjQ5QzU0LjY4MSAxMDEuMTc2IDQ1Ljg0MjMgMTA1LjAzOSAzOC41MTU0IDEwNS4wMzlDMTMuMjc4NSAxMDUuMDM5IDE0LjMyNTIgNzIuODQ2MyA0MC4wMjczIDcyLjg0NjNDNDUuMzc3MSA3Mi44NDYzIDQ5LjkxMjggNzQuMjUxMSA1NS43Mjc3IDc3Ljg4TDU5LjU2NTYgNjQuNDE3N0M0My43NDg5IDYwLjA4NjQgMzUuODQwNSA0Ny45MTE4IDQzLjYzMjYgMzAuNDY5M0g1Ni4xOTI5QzQ5LjIxNSA0Mi4wNTg2IDUzLjk4MzIgNTEuNjU3OCA2Mi44MjIgNTIuNzExNEM2Ny41OTAzIDM1LjczNzIgNzcuODI0NiAyMi41MDkgOTEuNDMxNiAyMi41MDlDOTkuMTA3NCAyMi41MDkgMTA1LjE1NSAyNy41NDI4IDEwNS4xNTUgMzYuNjczN0MxMDUuMTU1IDUxLjMwNjYgODYuMDgxOSA2My4yNDcxIDcxLjY2MDcgNjQuNDE3N0w2NS43Mjk1IDg1LjM3MjFDNzIuNDc0OCA5My4yMTUzIDkxLjE5OSAxMDAuODI0IDkxLjE5OSA3OS4yODQ4SDEwMi44MjlaIiBmaWxsPSIjRjVGMUVEIi8+Cjwvc3ZnPgo=',\n\n    webUrl: 'https://leather.io',\n    chromeWebStoreUrl:\n      'https://chrome.google.com/webstore/detail/hiro-wallet/ldinpeekobnhjjdofggfgjlcehhmanlj',\n    mozillaAddOnsUrl: 'https://leather.io/install-extension',\n  },\n  {\n    id: 'XverseProviders.StacksProvider',\n    name: 'Xverse Wallet',\n    icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGZpbGw9IiMxNzE3MTciIGQ9Ik0wIDBoNjAwdjYwMEgweiIvPjxwYXRoIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0ibm9uemVybyIgZD0iTTQ0MCA0MzUuNHYtNTFjMC0yLS44LTMuOS0yLjItNS4zTDIyMCAxNjIuMmE3LjYgNy42IDAgMCAwLTUuNC0yLjJoLTUxLjFjLTIuNSAwLTQuNiAyLTQuNiA0LjZ2NDcuM2MwIDIgLjggNCAyLjIgNS40bDc4LjIgNzcuOGE0LjYgNC42IDAgMCAxIDAgNi41bC03OSA3OC43Yy0xIC45LTEuNCAyLTEuNCAzLjJ2NTJjMCAyLjQgMiA0LjUgNC42IDQuNUgyNDljMi42IDAgNC42LTIgNC42LTQuNlY0MDVjMC0xLjIuNS0yLjQgMS40LTMuM2w0Mi40LTQyLjJhNC42IDQuNiAwIDAgMSA2LjQgMGw3OC43IDc4LjRhNy42IDcuNiAwIDAgMCA1LjQgMi4yaDQ3LjVjMi41IDAgNC42LTIgNC42LTQuNloiLz48cGF0aCBmaWxsPSIjRUU3QTMwIiBmaWxsLXJ1bGU9Im5vbnplcm8iIGQ9Ik0zMjUuNiAyMjcuMmg0Mi44YzIuNiAwIDQuNiAyLjEgNC42IDQuNnY0Mi42YzAgNCA1IDYuMSA4IDMuMmw1OC43LTU4LjVjLjgtLjggMS4zLTIgMS4zLTMuMnYtNTEuMmMwLTIuNi0yLTQuNi00LjYtNC42TDM4NCAxNjBjLTEuMiAwLTIuNC41LTMuMyAxLjNsLTU4LjQgNTguMWE0LjYgNC42IDAgMCAwIDMuMiA3LjhaIi8+PC9nPjwvc3ZnPg==',\n\n    webUrl: 'https://xverse.app',\n    chromeWebStoreUrl:\n      'https://chrome.google.com/webstore/detail/xverse-wallet/idnnbdplmphpflfnlkomgpfbpcgelopg',\n    googlePlayStoreUrl: 'https://play.google.com/store/apps/details?id=com.secretkeylabs.xverse',\n    iOSAppStoreUrl: 'https://apps.apple.com/app/xverse-bitcoin-web3-wallet/id1552272513',\n    mozillaAddOnsUrl: 'https://www.xverse.app/download',\n  },\n  {\n    id: 'AsignaProvider',\n    name: 'Asigna Multisig',\n    icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMDEwMCIgZD0iTTAgMGgzMnYzMkgweiIvPjxwYXRoIGZpbGw9InVybCgjYSkiIGQ9Ik0xNS4xMSA1LjU1YTMgMyAwIDAgMC0xLjgyIDEuM2wtLjA1LjA4LS40My43Mi0uMDcuMTEtLjUuODUtLjA1LjA5LTEuMjkgMi4xOC0uMDQuMDctLjQ3LjgtLjA2LjEtLjQ2Ljc4LS4wNy4xMS0xLjYzIDIuNzYtLjA3LjExLS4zOC42Ni0uMDUuMDgtLjczIDEuMjQtLjM1LjYtLjQuNjctLjA1LjA5TDUuMSAyMC43bC0uMTEuMTgtLjE0LjIzLS4wNy4xMy0uMzMuNTUtLjA0LjA3di4wMWExLjI2IDEuMjYgMCAwIDAtLjE0LjQ3IDEuMzEgMS4zMSAwIDAgMCAxLjI0IDEuNGgxLjVsLjA1LS4wNi4wNC0uMDYuODctMS4yMS4wNS0uMDguNzctMS4wNy4wNS0uMDcuNC0uNTcuMDUtLjA2LjI0LS4zNGExLjUyIDEuNTIgMCAwIDEgMS4zOS0uNjIgMS41IDEuNSAwIDAgMSAuNjQuMiAxLjQ3IDEuNDcgMCAwIDEgLjczIDEuMjcgMS40NCAxLjQ0IDAgMCAxLS4yNy44NGwtLjYzLjg4LS4wNS4wNy0uMzIuNDUtLjA2LjA4LS4wOC4xMi0uMTIuMTYtLjA1LjA4aDIuMTNhMi4zMiAyLjMyIDAgMCAwIDEuNzctLjk2bDEuMTgtMS42My43Ny0xLjA4IDEuMy0xLjhhMS4yNCAxLjI0IDAgMCAxIC41NS0uNDNsLjA4LS4wM2ExLjMgMS4zIDAgMCAxIC4zLS4wNiAxLjI4IDEuMjggMCAwIDEgMS4xNS41NGwuMTEuMmExLjEzIDEuMTMgMCAwIDEgLjEuNDEgMS4xOSAxLjE5IDAgMCAxLS4yMy43N2wtLjAzLjA1LS41Ny44LS43Ljk4LS4yNy4zN2ExLjIyIDEuMjIgMCAwIDAtLjIuNSAxLjA1IDEuMDUgMCAwIDAtLjAyLjIzdi4wNmExLjE3IDEuMTcgMCAwIDAgLjE0LjQzbC4wMi4wNS4wNy4xYTEuNDQgMS40NCAwIDAgMCAuMS4xMWwuMDUuMDYuMDEuMDFhMS44IDEuOCAwIDAgMCAuMTQuMWMwIC4wMi4wMi4wMy4wNC4wM2ExIDEgMCAwIDAgLjA4LjA1bC4wNy4wNGExLjI1IDEuMjUgMCAwIDAgLjUuMWg2LjljLjEgMCAuMi0uMDEuMjktLjAzbC4wNi0uMDJhMS4yNyAxLjI3IDAgMCAwIC4yNy0uMS41Ny41NyAwIDAgMCAuMDctLjAzIDEuMjEgMS4yMSAwIDAgMCAuMjYtLjE5bC4wOC0uMDdhLjkyLjkyIDAgMCAwIC4xNS0uMTkgMS41NSAxLjU1IDAgMCAwIC4wOS0uMTdsLjAyLS4wNWExLjIyIDEuMjIgMCAwIDAgLjA4LS4yNnYtLjA0bC4wMi0uMDh2LS4wOGExLjMyIDEuMzIgMCAwIDAtLjItLjc0bC0xLjYtMi42NC0uMDYtLjEtLjItLjMyLS4zMy0uNTR2LS4wMWwtLjA1LS4wOC0xLjMtMi4xNS0uMDctLjEtLjA0LS4wNi0uOC0xLjMyLS4wNC0uMDctLjItLjM0LS4xLS4xNC0uMS0uMTYtLjUzLS45LS4xMy0uMi0uMDktLjE0LTIuMTctMy41Ny0uMDQtLjA3LS43Mi0xLjE5LS4wNS0uMDctLjQtLjY1YTIuNjUgMi42NSAwIDAgMC0uMy0uNCAyLjk2IDIuOTYgMCAwIDAtLjk3LS43NCAzLjA0IDMuMDQgMCAwIDAtMS4zLS4zYy0uMjUgMC0uNS4wNC0uNzQuMVoiLz48cGF0aCBmaWxsPSJ1cmwoI2IpIiBkPSJNMTkgMTYuM2E1LjQ1IDUuNDUgMCAwIDAtLjgzIDEuNTZsLS4wNC4xNWExLjM2IDEuMzYgMCAwIDEgLjI4LS4xNiAxLjI0IDEuMjQgMCAwIDEgLjM4LS4wOGguMWExLjI4IDEuMjggMCAwIDEgMS4wNS41NGMuMDQuMDYuMDguMTMuMS4yYTEuMjQgMS4yNCAwIDAgMSAuMDkuMjcgMS4xOSAxLjE5IDAgMCAxLS4yLjkxbC0uMDQuMDUtLjU3Ljc5LS43Ljk5LS4yNy4zN2ExLjIzIDEuMjMgMCAwIDAtLjIuNDIgMS4wNiAxLjA2IDAgMCAwLS4wMi4zMXYuMDZhMS4xNyAxLjE3IDAgMCAwIC4xNi40Ny45My45MyAwIDAgMCAuMDcuMSAxLjUgMS41IDAgMCAwIC4xLjEybC4wNS4wNmguMDFhMS45NCAxLjk0IDAgMCAwIC4wOS4wOCAxIDEgMCAwIDAgLjE3LjFsLjA3LjA0YTEuMjUgMS4yNSAwIDAgMCAuNS4xaDYuOWMuMSAwIC4yIDAgLjI4LS4wMmwuMDctLjAyYTEuMzIgMS4zMiAwIDAgMCAuMzQtLjEzbC4xNi0uMS4wMy0uMDNhMS4yOSAxLjI5IDAgMCAwIC4yLS4yIDIuNDMgMi40MyAwIDAgMCAuMTItLjE3Yy4wMy0uMDMuMDUtLjA4LjA3LS4xMmwuMDItLjA1YTEuMjEgMS4yMSAwIDAgMCAuMDktLjN2LS4wOGwuMDEtLjA5YTEuMzIgMS4zMiAwIDAgMC0uMi0uNzNsLTEuNi0yLjY0LS4wNi0uMS0uMi0uMzItLjMzLS41NHYtLjAybC0uMDUtLjA3LTEuMy0yLjE1LS4xMi0uMDctLjA3LS4wNGE0Ljk0IDQuOTQgMCAwIDAtMi40Ni0uNjdjLTEuMDMgMC0xLjc2LjU3LTIuMjYgMS4yWiIvPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0xMi4yOSAyMS4wOGMwIC4yOS0uMDkuNTgtLjI3Ljg0bC0xLjMxIDEuODRIN2wyLjUyLTMuNTNhMS41NCAxLjU0IDAgMCAxIDIuMS0uMzZjLjQzLjI4LjY2Ljc0LjY2IDEuMloiLz48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMTEuMTYgMjEuMjVhLjU2LjU2IDAgMCAxLS41Ny41NS41Ni41NiAwIDAgMS0uNTctLjU2LjU2LjU2IDAgMCAxIC41Ny0uNTUuNTYuNTYgMCAwIDEgLjU3LjU2WiIvPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0iYSIgeDE9IjE1LjIzIiB4Mj0iMTkuMyIgeTE9IjI1Ljc4IiB5Mj0iNi4xMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiM2NTIyRjQiLz48c3RvcCBvZmZzZXQ9Ii41NSIgc3RvcC1jb2xvcj0iIzlCNkJGRiIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0E1ODVGRiIvPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJiIiB4MT0iMjIuNTkiIHgyPSIyNC44IiB5MT0iMjQuNzEiIHkyPSIxNS41MyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiM0MjFGOEIiLz48c3RvcCBvZmZzZXQ9Ii41NSIgc3RvcC1jb2xvcj0iIzcyMzBGRiIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzk3NzNGRiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjwvc3ZnPg==',\n    webUrl: 'https://asigna.io',\n    chromeWebStoreUrl: 'https://stx.asigna.io/',\n  },\n];\n"]}